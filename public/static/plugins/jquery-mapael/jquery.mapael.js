/*! For license information please see jquery.mapael.js.LICENSE.txt */
!function(t){"object"==typeof exports?module.exports=t(require("jquery"),require("raphael"),require("jquery-mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],t):t(jQuery,Raphael,jQuery.fn.mousewheel)}((function(t,e,o,a){"use strict";var n,i,s="mapael",r=function(e,o){var a=this;a.container=e,a.$container=t(e),a.options=a.extendDefaultOptions(o),a.zoomTO=0,a.zoomCenterX=0,a.zoomCenterY=0,a.previousPinchDist=0,a.zoomData={zoomLevel:0,zoomX:0,zoomY:0,panX:0,panY:0},a.currentViewBox={x:0,y:0,w:0,h:0},a.panning=!1,a.zoomAnimID=null,a.zoomAnimStartTime=null,a.zoomAnimCVBTarget=null,a.$map=t("."+a.options.map.cssClass,a.container),a.initialMapHTMLContent=a.$map.html(),a.$tooltip={},a.paper={},a.areas={},a.plots={},a.links={},a.legends={},a.mapConf={},a.customEventHandlers={},a.init()};return r.prototype={MouseOverFilteringTO:120,panningFilteringTO:150,panningEndFilteringTO:50,zoomFilteringTO:150,resizeFilteringTO:150,init:function(){var o=this;if(""===o.options.map.cssClass||0===t("."+o.options.map.cssClass,o.container).length)throw new Error("The map class `"+o.options.map.cssClass+"` doesn't exists");if(o.$tooltip=t("<div>").addClass(o.options.map.tooltip.cssClass).css("display","none"),o.$map.empty().append(o.$tooltip),t.mapael&&t.mapael.maps&&t.mapael.maps[o.options.map.name])o.mapConf=t.mapael.maps[o.options.map.name];else{if(!(t.fn.mapael&&t.fn.mapael.maps&&t.fn.mapael.maps[o.options.map.name]))throw new Error("Unknown map '"+o.options.map.name+"'");o.mapConf=t.fn.mapael.maps[o.options.map.name],window.console&&window.console.warn&&window.console.warn("Extending $.fn.mapael is deprecated (map '"+o.options.map.name+"')")}if(o.paper=new e(o.$map[0],o.mapConf.width,o.mapConf.height),!0===o.isRaphaelBBoxBugPresent())throw o.destroy(),new Error("Can't get boundary box for text (is your container hidden? See #135)");o.$container.addClass(s),o.options.map.tooltip.css&&o.$tooltip.css(o.options.map.tooltip.css),o.setViewBox(0,0,o.mapConf.width,o.mapConf.height),o.options.map.width?o.paper.setSize(o.options.map.width,o.mapConf.height*(o.options.map.width/o.mapConf.width)):o.initResponsiveSize(),t.each(o.mapConf.elems,(function(t){o.areas[t]={},o.areas[t].options=o.getElemOptions(o.options.map.defaultArea,o.options.areas[t]?o.options.areas[t]:{},o.options.legend.area),o.areas[t].mapElem=o.paper.path(o.mapConf.elems[t])})),o.options.map.beforeInit&&o.options.map.beforeInit(o.$container,o.paper,o.options),t.each(o.mapConf.elems,(function(t){o.initElem(t,"area",o.areas[t])})),o.links=o.drawLinksCollection(o.options.links),t.each(o.options.plots,(function(t){o.plots[t]=o.drawPlot(t)})),o.$container.on("zoom.mapael",(function(t,e){o.onZoomEvent(t,e)})),o.options.map.zoom.enabled&&o.initZoom(o.mapConf.width,o.mapConf.height,o.options.map.zoom),o.options.map.zoom.init!==a&&(o.options.map.zoom.init.animDuration===a&&(o.options.map.zoom.init.animDuration=0),o.$container.trigger("zoom",o.options.map.zoom.init)),o.createLegends("area",o.areas,1),o.createLegends("plot",o.plots,o.paper.width/o.mapConf.width),o.$container.on("update.mapael",(function(t,e){o.onUpdateEvent(t,e)})),o.$container.on("showElementsInRange.mapael",(function(t,e){o.onShowElementsInRange(t,e)})),o.initDelegatedMapEvents(),o.initDelegatedCustomEvents(),o.options.map.afterInit&&o.options.map.afterInit(o.$container,o.paper,o.areas,o.plots,o.options),t(o.paper.desc).append(" and Mapael "+o.version+" (https://www.vincentbroute.fr/mapael/)")},destroy:function(){var e=this;e.$container.off(".mapael"),e.$map.off(".mapael"),e.onResizeEvent&&t(window).off("resize.mapael",e.onResizeEvent),e.$map.empty(),e.$map.html(e.initialMapHTMLContent),t.each(e.legends,(function(o){t.each(e.legends[o],(function(t){var a=e.legends[o][t];a.container.empty(),a.container.html(a.initialHTMLContent)}))})),e.$container.removeClass(s),e.$container.removeData(s),e.container=a,e.$container=a,e.options=a,e.paper=a,e.$map=a,e.$tooltip=a,e.mapConf=a,e.areas=a,e.plots=a,e.links=a,e.customEventHandlers=a},initResponsiveSize:function(){var e=this,o=null,a=function(t){var o=e.$map.width();if(e.paper.width!==o){var a=o/e.mapConf.width;e.paper.setSize(o,e.mapConf.height*a),!0!==t&&e.options.legend.redrawOnResize&&e.createLegends("plot",e.plots,a)}};e.onResizeEvent=function(){clearTimeout(o),o=setTimeout((function(){a()}),e.resizeFilteringTO)},t(window).on("resize.mapael",e.onResizeEvent),a(!0)},extendDefaultOptions:function(e){return e=t.extend(!0,{},r.prototype.defaultOptions,e),t.each(["area","plot"],(function(o,a){if(t.isArray(e.legend[a]))for(var n=0;n<e.legend[a].length;++n)e.legend[a][n]=t.extend(!0,{},r.prototype.legendDefaultOptions[a],e.legend[a][n]);else e.legend[a]=t.extend(!0,{},r.prototype.legendDefaultOptions[a],e.legend[a])})),e},initDelegatedMapEvents:function(){var e,o,n=this,i={area:n.areas,"area-text":n.areas,plot:n.plots,"plot-text":n.plots,link:n.links,"link-text":n.links};n.$container.on("mouseover.mapael","[data-id]",(function(){var o=this;clearTimeout(e),e=setTimeout((function(){var e=t(o),s=e.attr("data-id"),r=e.attr("data-type");if(i[r]!==a)n.elemEnter(i[r][s]);else if("legend-elem"===r||"legend-label"===r){var p=e.attr("data-legend-id"),l=e.attr("data-legend-type");n.elemEnter(n.legends[l][p].elems[s])}}),n.MouseOverFilteringTO)})),n.$container.on("mousemove.mapael","[data-id]",(function(e){var s=this;clearTimeout(o),o=setTimeout((function(){var o=t(s),r=o.attr("data-id"),p=o.attr("data-type");i[p]!==a&&n.elemHover(i[p][r],e)}),0)})),n.$container.on("mouseout.mapael","[data-id]",(function(){clearTimeout(e),clearTimeout(o);var s=t(this),r=s.attr("data-id"),p=s.attr("data-type");if(i[p]!==a)n.elemOut(i[p][r]);else if("legend-elem"===p||"legend-label"===p){var l=s.attr("data-legend-id"),m=s.attr("data-legend-type");n.elemOut(n.legends[m][l].elems[r])}})),n.$container.on("click.mapael","[data-id]",(function(e,o){var s=t(this),r=s.attr("data-id"),p=s.attr("data-type");if(i[p]!==a)n.elemClick(i[p][r]);else if("legend-elem"===p||"legend-label"===p){var l=s.attr("data-legend-id"),m=s.attr("data-legend-type");n.handleClickOnLegendElem(n.legends[m][l].elems[r],r,l,m,o)}}))},initDelegatedCustomEvents:function(){var e=this;t.each(e.customEventHandlers,(function(o){var n=o+".mapael.custom";e.$container.off(n).on(n,"[data-id]",(function(n){var i=t(this),s=i.attr("data-id"),r=i.attr("data-type").replace("-text","");if(!e.panning&&e.customEventHandlers[o][r]!==a&&e.customEventHandlers[o][r][s]!==a){var p=e.customEventHandlers[o][r][s];p.options.eventHandlers[o](n,s,p.mapElem,p.textElem,p.options)}}))}))},initElem:function(e,o,n){var i=this,s=t(n.mapElem.node);if(n.options.href&&(n.options.attrs.cursor="pointer",n.options.text&&(n.options.text.attrs.cursor="pointer")),n.mapElem.attr(n.options.attrs),s.attr({"data-id":e,"data-type":o}),n.options.cssClass!==a&&s.addClass(n.options.cssClass),n.options.text&&n.options.text.content!==a){var r=i.getTextPosition(n.mapElem.getBBox(),n.options.text.position,n.options.text.margin);n.options.text.attrs.text=n.options.text.content,n.options.text.attrs.x=r.x,n.options.text.attrs.y=r.y,n.options.text.attrs["text-anchor"]=r.textAnchor,n.textElem=i.paper.text(r.x,r.y,n.options.text.content),n.textElem.attr(n.options.text.attrs),t(n.textElem.node).attr({"data-id":e,"data-type":o+"-text"})}n.options.eventHandlers&&i.setEventHandlers(e,o,n),i.setHoverOptions(n.mapElem,n.options.attrs,n.options.attrsHover),n.textElem&&i.setHoverOptions(n.textElem,n.options.text.attrs,n.options.text.attrsHover)},initZoom:function(e,o,n){var i=this,s=!1,r=0,p=0,l={reset:function(){i.$container.trigger("zoom",{level:0})},in:function(){i.$container.trigger("zoom",{level:"+1"})},out:function(){i.$container.trigger("zoom",{level:-1})}};t.extend(i.zoomData,{zoomLevel:0,panX:0,panY:0}),t.each(n.buttons,(function(e,o){if(l[e]===a)throw new Error("Unknown zoom button '"+e+"'");var n=t("<div>").addClass(o.cssClass).html(o.content).attr("title",o.title);n.on("click.mapael",l[e]),i.$map.append(n)})),i.options.map.zoom.mousewheel&&i.$map.on("mousewheel.mapael",(function(t){var e=t.deltaY>0?1:-1,o=i.mapPagePositionToXY(t.pageX,t.pageY);i.$container.trigger("zoom",{fixedCenter:!0,level:i.zoomData.zoomLevel+e,x:o.x,y:o.y}),t.preventDefault()})),i.options.map.zoom.touch&&(i.$map.on("touchstart.mapael",(function(t){2===t.originalEvent.touches.length&&(i.zoomCenterX=(t.originalEvent.touches[0].pageX+t.originalEvent.touches[1].pageX)/2,i.zoomCenterY=(t.originalEvent.touches[0].pageY+t.originalEvent.touches[1].pageY)/2,i.previousPinchDist=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)))})),i.$map.on("touchmove.mapael",(function(t){var e=0,o=0;if(2===t.originalEvent.touches.length){if(e=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)),Math.abs(e-i.previousPinchDist)>15){var a=i.mapPagePositionToXY(i.zoomCenterX,i.zoomCenterY);o=(e-i.previousPinchDist)/Math.abs(e-i.previousPinchDist),i.$container.trigger("zoom",{fixedCenter:!0,level:i.zoomData.zoomLevel+o,x:a.x,y:a.y}),i.previousPinchDist=e}return!1}}))),i.$map.on("dragstart",(function(){return!1}));var m=null,c=null;t("body").on("mouseup.mapael"+(n.touch?" touchend.mapael":""),(function(){s=!1,clearTimeout(m),clearTimeout(c),m=setTimeout((function(){i.panning=!1}),i.panningEndFilteringTO)})),i.$map.on("mousedown.mapael"+(n.touch?" touchstart.mapael":""),(function(t){clearTimeout(m),clearTimeout(c),t.pageX!==a?(s=!0,r=t.pageX,p=t.pageY):1===t.originalEvent.touches.length&&(s=!0,r=t.originalEvent.touches[0].pageX,p=t.originalEvent.touches[0].pageY)})).on("mousemove.mapael"+(n.touch?" touchmove.mapael":""),(function(l){var d=i.zoomData.zoomLevel,h=0,f=0;if(clearTimeout(m),clearTimeout(c),l.pageX!==a?(h=l.pageX,f=l.pageY):1===l.originalEvent.touches.length?(h=l.originalEvent.touches[0].pageX,f=l.originalEvent.touches[0].pageY):s=!1,s&&0!==d){var g=(r-h)/(1+d*n.step)*(e/i.paper.width),u=(p-f)/(1+d*n.step)*(o/i.paper.height),x=Math.min(Math.max(0,i.currentViewBox.x+g),e-i.currentViewBox.w),v=Math.min(Math.max(0,i.currentViewBox.y+u),o-i.currentViewBox.h);return(Math.abs(g)>5||Math.abs(u)>5)&&(t.extend(i.zoomData,{panX:x,panY:v,zoomX:x+i.currentViewBox.w/2,zoomY:v+i.currentViewBox.h/2}),i.setViewBox(x,v,i.currentViewBox.w,i.currentViewBox.h),c=setTimeout((function(){i.$map.trigger("afterPanning",{x1:x,y1:v,x2:x+i.currentViewBox.w,y2:v+i.currentViewBox.h})}),i.panningFilteringTO),r=h,p=f,i.panning=!0),!1}}))},mapPagePositionToXY:function(t,e){var o=this,a=o.$map.offset(),n=o.options.map.width?o.mapConf.width/o.options.map.width:o.mapConf.width/o.$map.width(),i=1/(1+o.zoomData.zoomLevel*o.options.map.zoom.step);return{x:i*n*(t-a.left)+o.zoomData.panX,y:i*n*(e-a.top)+o.zoomData.panY}},onZoomEvent:function(e,o){var n,i,s,r,p,l=this,m=l.zoomData.zoomLevel,c=1+l.zoomData.zoomLevel*l.options.map.zoom.step,d=o.animDuration!==a?o.animDuration:l.options.map.zoom.animDuration;if(o.area!==a){if(l.areas[o.area]===a)throw new Error("Unknown area '"+o.area+"'");var h=o.areaMargin!==a?o.areaMargin:10,f=l.areas[o.area].mapElem.getBBox(),g=f.width+2*h,u=f.height+2*h;o.x=f.cx,o.y=f.cy,m=Math.min(Math.floor((l.mapConf.width/g-1)/l.options.map.zoom.step),Math.floor((l.mapConf.height/u-1)/l.options.map.zoom.step))}else if(o.level!==a&&(m="string"==typeof o.level?"+"===o.level.slice(0,1)||"-"===o.level.slice(0,1)?l.zoomData.zoomLevel+parseInt(o.level,10):parseInt(o.level,10):o.level<0?l.zoomData.zoomLevel+o.level:o.level),o.plot!==a){if(l.plots[o.plot]===a)throw new Error("Unknown plot '"+o.plot+"'");o.x=l.plots[o.plot].coords.x,o.y=l.plots[o.plot].coords.y}else{if(o.latitude!==a&&o.longitude!==a){var x=l.mapConf.getCoords(o.latitude,o.longitude);o.x=x.x,o.y=x.y}o.x===a&&(o.x=l.currentViewBox.x+l.currentViewBox.w/2),o.y===a&&(o.y=l.currentViewBox.y+l.currentViewBox.h/2)}p=1+(m=Math.min(Math.max(m,l.options.map.zoom.minLevel),l.options.map.zoom.maxLevel))*l.options.map.zoom.step,s=l.mapConf.width/p,r=l.mapConf.height/p,0===m?(n=0,i=0):(o.fixedCenter!==a&&!0===o.fixedCenter?(n=l.zoomData.panX+(o.x-l.zoomData.panX)*(p-c)/p,i=l.zoomData.panY+(o.y-l.zoomData.panY)*(p-c)/p):(n=o.x-s/2,i=o.y-r/2),n=Math.min(Math.max(0,n),l.mapConf.width-s),i=Math.min(Math.max(0,i),l.mapConf.height-r)),p===c&&n===l.zoomData.panX&&i===l.zoomData.panY||(d>0?l.animateViewBox(n,i,s,r,d,l.options.map.zoom.animEasing):(l.setViewBox(n,i,s,r),clearTimeout(l.zoomTO),l.zoomTO=setTimeout((function(){l.$map.trigger("afterZoom",{x1:n,y1:i,x2:n+s,y2:i+r})}),l.zoomFilteringTO)),t.extend(l.zoomData,{zoomLevel:m,panX:n,panY:i,zoomX:n+s/2,zoomY:i+r/2}))},onShowElementsInRange:function(t,e){var o=this;e.animDuration===a&&(e.animDuration=0),e.hiddenOpacity===a&&(e.hiddenOpacity=.3),e.ranges&&e.ranges.area&&o.showElemByRange(e.ranges.area,o.areas,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.plot&&o.showElemByRange(e.ranges.plot,o.plots,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.link&&o.showElemByRange(e.ranges.link,o.links,e.hiddenOpacity,e.animDuration),e.afterShowRange&&e.afterShowRange()},showElemByRange:function(e,o,n,i){var s=this,r={};e.min===a&&e.max===a||(e={0:e}),t.each(e,(function(i){var s=e[i];if(s.min===a&&s.max===a)return!0;t.each(o,(function(t){var e=o[t].options.value;if("object"!=typeof e&&(e=[e]),e[i]===a)return!0;s.min!==a&&e[i]<s.min||s.max!==a&&e[i]>s.max?r[t]=n:r[t]=1}))})),t.each(r,(function(t){s.setElementOpacity(o[t],r[t],i)}))},setElementOpacity:function(t,e,o){e>0&&(t.mapElem.show(),t.textElem&&t.textElem.show()),this.animate(t.mapElem,{opacity:e},o,(function(){0===e&&t.mapElem.hide()})),this.animate(t.textElem,{opacity:e},o,(function(){0===e&&t.textElem.hide()}))},onUpdateEvent:function(e,o){var n=this;if("object"==typeof o){var i=0,s=o.animDuration?o.animDuration:0,r=function(t){n.animate(t.mapElem,{opacity:0},s,(function(){t.mapElem.remove()})),n.animate(t.textElem,{opacity:0},s,(function(){t.textElem.remove()}))},p=function(t){t.mapElem.attr({opacity:0}),t.textElem&&t.textElem.attr({opacity:0}),n.setElementOpacity(t,t.mapElem.originalAttrs.opacity!==a?t.mapElem.originalAttrs.opacity:1,s)};if("object"==typeof o.mapOptions&&(!0===o.replaceOptions?n.options=n.extendDefaultOptions(o.mapOptions):t.extend(!0,n.options,o.mapOptions),o.mapOptions.areas===a&&o.mapOptions.plots===a&&o.mapOptions.legend===a||t("[data-type='legend-elem']",n.$container).each((function(e,o){"1"===t(o).attr("data-hidden")&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})}))),"object"==typeof o.deletePlotKeys)for(;i<o.deletePlotKeys.length;i++)n.plots[o.deletePlotKeys[i]]!==a&&(r(n.plots[o.deletePlotKeys[i]]),delete n.plots[o.deletePlotKeys[i]]);else"all"===o.deletePlotKeys&&(t.each(n.plots,(function(t,e){r(e)})),n.plots={});if("object"==typeof o.deleteLinkKeys)for(i=0;i<o.deleteLinkKeys.length;i++)n.links[o.deleteLinkKeys[i]]!==a&&(r(n.links[o.deleteLinkKeys[i]]),delete n.links[o.deleteLinkKeys[i]]);else"all"===o.deleteLinkKeys&&(t.each(n.links,(function(t,e){r(e)})),n.links={});if("object"==typeof o.newPlots&&t.each(o.newPlots,(function(t){n.plots[t]===a&&(n.options.plots[t]=o.newPlots[t],n.plots[t]=n.drawPlot(t),s>0&&p(n.plots[t]))})),"object"==typeof o.newLinks){var l=n.drawLinksCollection(o.newLinks);t.extend(n.links,l),t.extend(n.options.links,o.newLinks),s>0&&t.each(l,(function(t){p(l[t])}))}if(t.each(n.areas,(function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultArea||"object"==typeof o.mapOptions.areas&&"object"==typeof o.mapOptions.areas[t]||"object"==typeof o.mapOptions.legend&&"object"==typeof o.mapOptions.legend.area)||!0===o.replaceOptions)&&(n.areas[t].options=n.getElemOptions(n.options.map.defaultArea,n.options.areas[t]?n.options.areas[t]:{},n.options.legend.area),n.updateElem(n.areas[t],s))})),t.each(n.plots,(function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultPlot||"object"==typeof o.mapOptions.plots&&"object"==typeof o.mapOptions.plots[t]||"object"==typeof o.mapOptions.legend&&"object"==typeof o.mapOptions.legend.plot)||!0===o.replaceOptions)&&(n.plots[t].options=n.getElemOptions(n.options.map.defaultPlot,n.options.plots[t]?n.options.plots[t]:{},n.options.legend.plot),n.setPlotCoords(n.plots[t]),n.setPlotAttributes(n.plots[t]),n.updateElem(n.plots[t],s))})),t.each(n.links,(function(t){("object"==typeof o.mapOptions&&("object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultLink||"object"==typeof o.mapOptions.links&&"object"==typeof o.mapOptions.links[t])||!0===o.replaceOptions)&&(n.links[t].options=n.getElemOptions(n.options.map.defaultLink,n.options.links[t]?n.options.links[t]:{},{}),n.updateElem(n.links[t],s))})),o.mapOptions&&("object"==typeof o.mapOptions.legend||"object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultArea||"object"==typeof o.mapOptions.map&&"object"==typeof o.mapOptions.map.defaultPlot)&&(t("[data-type='legend-elem']",n.$container).each((function(e,o){"1"===t(o).attr("data-hidden")&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})})),n.createLegends("area",n.areas,1),n.options.map.width?n.createLegends("plot",n.plots,n.options.map.width/n.mapConf.width):n.createLegends("plot",n.plots,n.$map.width()/n.mapConf.width)),"object"==typeof o.setLegendElemsState)t.each(o.setLegendElemsState,(function(e,o){var i=n.$container.find("."+e)[0];i!==a&&t("[data-type='legend-elem']",i).each((function(e,a){("0"===t(a).attr("data-hidden")&&"hide"===o||"1"===t(a).attr("data-hidden")&&"show"===o)&&t(a).trigger("click",{hideOtherElems:!1,animDuration:s})}))}));else{var m="hide"===o.setLegendElemsState?"hide":"show";t("[data-type='legend-elem']",n.$container).each((function(e,o){("0"===t(o).attr("data-hidden")&&"hide"===m||"1"===t(o).attr("data-hidden")&&"show"===m)&&t(o).trigger("click",{hideOtherElems:!1,animDuration:s})}))}n.initDelegatedCustomEvents(),o.afterUpdate&&o.afterUpdate(n.$container,n.paper,n.areas,n.plots,n.options,n.links)}},setPlotCoords:function(t){var e=this;if(t.options.x!==a&&t.options.y!==a)t.coords={x:t.options.x,y:t.options.y};else if(t.options.plotsOn!==a&&e.areas[t.options.plotsOn]!==a){var o=e.areas[t.options.plotsOn].mapElem.getBBox();t.coords={x:o.cx,y:o.cy}}else t.coords=e.mapConf.getCoords(t.options.latitude,t.options.longitude)},setPlotAttributes:function(t){"square"===t.options.type?(t.options.attrs.width=t.options.size,t.options.attrs.height=t.options.size,t.options.attrs.x=t.coords.x-t.options.size/2,t.options.attrs.y=t.coords.y-t.options.size/2):"image"===t.options.type?(t.options.attrs.src=t.options.url,t.options.attrs.width=t.options.width,t.options.attrs.height=t.options.height,t.options.attrs.x=t.coords.x-t.options.width/2,t.options.attrs.y=t.coords.y-t.options.height/2):"svg"===t.options.type?(t.options.attrs.path=t.options.path,t.options.attrs.transform===a&&(t.options.attrs.transform=""),t.mapElem.originalBBox===a&&(t.mapElem.originalBBox=t.mapElem.getBBox()),t.mapElem.baseTransform="m"+t.options.width/t.mapElem.originalBBox.width+",0,0,"+t.options.height/t.mapElem.originalBBox.height+","+(t.coords.x-t.options.width/2)+","+(t.coords.y-t.options.height/2),t.options.attrs.transform=t.mapElem.baseTransform+t.options.attrs.transform):(t.options.attrs.x=t.coords.x,t.options.attrs.y=t.coords.y,t.options.attrs.r=t.options.size/2)},drawLinksCollection:function(e){var o=this,n={},i={},s={},r={},p={};return t.each(e,(function(t){var l=o.getElemOptions(o.options.map.defaultLink,e[t],{});if(n="string"==typeof e[t].between[0]?o.options.plots[e[t].between[0]]:e[t].between[0],i="string"==typeof e[t].between[1]?o.options.plots[e[t].between[1]]:e[t].between[1],n.plotsOn!==a&&o.areas[n.plotsOn]!==a){var m=o.areas[n.plotsOn].mapElem.getBBox();s={x:m.cx,y:m.cy}}else n.latitude!==a&&n.longitude!==a?s=o.mapConf.getCoords(n.latitude,n.longitude):(s.x=n.x,s.y=n.y);if(i.plotsOn!==a&&o.areas[i.plotsOn]!==a){var c=o.areas[i.plotsOn].mapElem.getBBox();r={x:c.cx,y:c.cy}}else i.latitude!==a&&i.longitude!==a?r=o.mapConf.getCoords(i.latitude,i.longitude):(r.x=i.x,r.y=i.y);p[t]=o.drawLink(t,s.x,s.y,r.x,r.y,l)})),p},drawLink:function(t,e,o,a,n,i){var s,r={options:i},p=(e+a)/2,l=(o+n)/2,m=-1/((n-o)/(a-e)),c=l-m*p,d=Math.sqrt((a-e)*(a-e)+(n-o)*(n-o)),h=1+m*m,f=-2*p+2*m*c-2*m*l,g=f*f-4*h*(p*p+c*c-c*l-l*c+l*l-i.factor*d*(i.factor*d)),u=0;return s=i.factor>0?m*(u=(-f+Math.sqrt(g))/(2*h))+c:m*(u=(-f-Math.sqrt(g))/(2*h))+c,r.mapElem=this.paper.path("m "+e+","+o+" C "+u+","+s+" "+a+","+n+" "+a+","+n),this.initElem(t,"link",r),r},isAttrsChanged:function(t,e){for(var o in e)if(e.hasOwnProperty(o)&&void 0===t[o]||e[o]!==t[o])return!0;return!1},updateElem:function(e,o){var n,i,s,r=this;if(!0===e.options.toFront&&e.mapElem.toFront(),e.options.href!==a?(e.options.attrs.cursor="pointer",e.options.text&&(e.options.text.attrs.cursor="pointer")):"pointer"===e.mapElem.attrs.cursor&&(e.options.attrs.cursor="auto",e.options.text&&(e.options.text.attrs.cursor="auto")),e.textElem){e.options.text.attrs.text=e.options.text.content,n=e.mapElem.getBBox(),(e.options.size||e.options.width&&e.options.height)&&("image"===e.options.type||"svg"===e.options.type?(i=(e.options.width-n.width)/2,s=(e.options.height-n.height)/2):(i=(e.options.size-n.width)/2,s=(e.options.size-n.height)/2),n.x-=i,n.x2+=i,n.y-=s,n.y2+=s);var p=r.getTextPosition(n,e.options.text.position,e.options.text.margin);e.options.text.attrs.x=p.x,e.options.text.attrs.y=p.y,e.options.text.attrs["text-anchor"]=p.textAnchor,r.setHoverOptions(e.textElem,e.options.text.attrs,e.options.text.attrsHover),r.isAttrsChanged(e.textElem.attrs,e.options.text.attrs)&&r.animate(e.textElem,e.options.text.attrs,o)}r.setHoverOptions(e.mapElem,e.options.attrs,e.options.attrsHover),r.isAttrsChanged(e.mapElem.attrs,e.options.attrs)&&r.animate(e.mapElem,e.options.attrs,o),e.options.cssClass!==a&&t(e.mapElem.node).removeClass().addClass(e.options.cssClass)},drawPlot:function(t){var e=this,o={};return o.options=e.getElemOptions(e.options.map.defaultPlot,e.options.plots[t]?e.options.plots[t]:{},e.options.legend.plot),e.setPlotCoords(o),"svg"===o.options.type&&(o.mapElem=e.paper.path(o.options.path)),e.setPlotAttributes(o),"square"===o.options.type?o.mapElem=e.paper.rect(o.options.attrs.x,o.options.attrs.y,o.options.attrs.width,o.options.attrs.height):"image"===o.options.type?o.mapElem=e.paper.image(o.options.attrs.src,o.options.attrs.x,o.options.attrs.y,o.options.attrs.width,o.options.attrs.height):"svg"===o.options.type||(o.mapElem=e.paper.circle(o.options.attrs.x,o.options.attrs.y,o.options.attrs.r)),e.initElem(t,"plot",o),o},setEventHandlers:function(e,o,n){var i=this;t.each(n.options.eventHandlers,(function(t){i.customEventHandlers[t]===a&&(i.customEventHandlers[t]={}),i.customEventHandlers[t][o]===a&&(i.customEventHandlers[t][o]={}),i.customEventHandlers[t][o][e]=n}))},drawLegend:function(o,n,i,s,r){var p=this,l={},m={},c=0,d=0,h=null,f=null,g={},u=0,x=0,v=0,w=0,y=[],E=(l=t("."+o.cssClass,p.$container)).html();for(l.empty(),m=new e(l.get(0)),t(m.canvas).attr({"data-legend-type":n,"data-legend-id":r}),d=c=0,o.title&&""!==o.title&&(f=(h=m.text(o.marginLeftTitle,0,o.title).attr(o.titleAttrs)).getBBox(),h.attr({y:.5*f.height}),c=o.marginLeftTitle+f.width,d+=o.marginBottomTitle+f.height),u=0;u<o.slices.length;++u){var z=0;y[u]=t.extend(!0,{},"plot"===n?p.options.map.defaultPlot:p.options.map.defaultArea,o.slices[u]),o.slices[u].legendSpecificAttrs===a&&(o.slices[u].legendSpecificAttrs={}),t.extend(!0,y[u].attrs,o.slices[u].legendSpecificAttrs),"area"===n?(y[u].attrs.width===a&&(y[u].attrs.width=30),y[u].attrs.height===a&&(y[u].attrs.height=20)):"square"===y[u].type?(y[u].attrs.width===a&&(y[u].attrs.width=y[u].size),y[u].attrs.height===a&&(y[u].attrs.height=y[u].size)):"image"===y[u].type||"svg"===y[u].type?(y[u].attrs.width===a&&(y[u].attrs.width=y[u].width),y[u].attrs.height===a&&(y[u].attrs.height=y[u].height)):y[u].attrs.r===a&&(y[u].attrs.r=y[u].size/2),z=o.marginBottomTitle,h&&(z+=f.height),"plot"!==n||y[u].type!==a&&"circle"!==y[u].type?z+=s*y[u].attrs.height/2:z+=s*y[u].attrs.r,w=Math.max(w,z)}for("horizontal"===o.mode&&(c=o.marginLeft),u=0;u<y.length;++u){var C={},O={},B={};if(y[u].display===a||!0===y[u].display){if("area"===n||"square"===y[u].type?("horizontal"===o.mode?(x=c+o.marginLeft,v=w-.5*s*y[u].attrs.height):(x=o.marginLeft,v=d),C=m.rect(x,v,s*y[u].attrs.width,s*y[u].attrs.height)):"image"===y[u].type||"svg"===y[u].type?("horizontal"===o.mode?(x=c+o.marginLeft,v=w-.5*s*y[u].attrs.height):(x=o.marginLeft,v=d),"image"===y[u].type?C=m.image(y[u].url,x,v,s*y[u].attrs.width,s*y[u].attrs.height):(C=m.path(y[u].path),y[u].attrs.transform===a&&(y[u].attrs.transform=""),O=C.getBBox(),y[u].attrs.transform="m"+s*y[u].width/O.width+",0,0,"+s*y[u].height/O.height+","+x+","+v+y[u].attrs.transform)):("horizontal"===o.mode?(x=c+o.marginLeft+s*y[u].attrs.r,v=w):(x=o.marginLeft+s*y[u].attrs.r,v=d+s*y[u].attrs.r),C=m.circle(x,v,s*y[u].attrs.r)),delete y[u].attrs.width,delete y[u].attrs.height,delete y[u].attrs.r,C.attr(y[u].attrs),O=C.getBBox(),"horizontal"===o.mode?(x=c+o.marginLeft+O.width+o.marginLeftLabel,v=w):(x=o.marginLeft+O.width+o.marginLeftLabel,v=d+O.height/2),B=m.text(x,v,y[u].label).attr(o.labelAttrs),"horizontal"===o.mode){var b=o.marginBottom+O.height;c+=o.marginLeft+O.width+o.marginLeftLabel+B.getBBox().width,"image"!==y[u].type&&"area"!==n&&(b+=o.marginBottomTitle),h&&(b+=f.height),d=Math.max(d,b)}else c=Math.max(c,o.marginLeft+O.width+o.marginLeftLabel+B.getBBox().width),d+=o.marginBottom+O.height;t(C.node).attr({"data-legend-id":r,"data-legend-type":n,"data-type":"legend-elem","data-id":u,"data-hidden":0}),t(B.node).attr({"data-legend-id":r,"data-legend-type":n,"data-type":"legend-label","data-id":u,"data-hidden":0}),g[u]={mapElem:C,textElem:B},o.hideElemsOnClick.enabled&&(B.attr({cursor:"pointer"}),C.attr({cursor:"pointer"}),p.setHoverOptions(C,y[u].attrs,y[u].attrs),p.setHoverOptions(B,o.labelAttrs,o.labelAttrsHover),y[u].clicked!==a&&!0===y[u].clicked&&p.handleClickOnLegendElem(g[u],u,r,n,{hideOtherElems:!1}))}}return"SVG"!==e.type&&o.VMLWidth&&(c=o.VMLWidth),m.setSize(c,d),{container:l,initialHTMLContent:E,elems:g}},handleClickOnLegendElem:function(e,o,n,i,s){var r,p=this;s=s||{},r=t.isArray(p.options.legend[i])?p.options.legend[i][n]:p.options.legend[i];var l=e.mapElem,m=e.textElem,c=t(l.node),d=t(m.node),h=r.slices[o],f="area"===i?p.areas:p.plots,g=s.animDuration!==a?s.animDuration:r.hideElemsOnClick.animDuration,u=c.attr("data-hidden"),x="0"===u?{"data-hidden":"1"}:{"data-hidden":"0"};"0"===u?p.animate(m,{opacity:.5},g):p.animate(m,{opacity:1},g),t.each(f,(function(e){var o,i=f[e].mapElem.data("hidden-by");i===a&&(i={}),o=t.isArray(f[e].options.value)?f[e].options.value[n]:f[e].options.value,p.getLegendSlice(o,r)===h&&("0"===u?(i[n]=!0,p.setElementOpacity(f[e],r.hideElemsOnClick.opacity,g)):(delete i[n],t.isEmptyObject(i)&&p.setElementOpacity(f[e],f[e].mapElem.originalAttrs.opacity!==a?f[e].mapElem.originalAttrs.opacity:1,g)),f[e].mapElem.data("hidden-by",i))})),c.attr(x),d.attr(x),s.hideOtherElems!==a&&!0!==s.hideOtherElems||!0!==r.exclusive||t("[data-type='legend-elem'][data-hidden=0]",p.$container).each((function(){var e=t(this);e.attr("data-id")!==o&&e.trigger("click",{hideOtherElems:!1})}))},createLegends:function(e,o,a){var n=this,i=n.options.legend[e];t.isArray(n.options.legend[e])||(i=[n.options.legend[e]]),n.legends[e]={};for(var s=0;s<i.length;++s)!0===i[s].display&&t.isArray(i[s].slices)&&i[s].slices.length>0&&""!==i[s].cssClass&&0!==t("."+i[s].cssClass,n.$container).length&&(n.legends[e][s]=n.drawLegend(i[s],e,o,a,s))},setHoverOptions:function(o,a,n){"SVG"!==e.type&&delete n.transform,o.attrsHover=n,o.attrsHover.transform?o.originalAttrs=t.extend({transform:"s1"},a):o.originalAttrs=a},elemEnter:function(t){var e=this;if(t!==a){if(t.mapElem!==a&&e.animate(t.mapElem,t.mapElem.attrsHover,t.mapElem.attrsHover.animDuration),t.textElem!==a&&e.animate(t.textElem,t.textElem.attrsHover,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==a){var o="";e.$tooltip.removeClass().addClass(e.options.map.tooltip.cssClass),t.options.tooltip.content!==a&&(o="function"==typeof t.options.tooltip.content?t.options.tooltip.content(t.mapElem):t.options.tooltip.content),t.options.tooltip.cssClass!==a&&e.$tooltip.addClass(t.options.tooltip.cssClass),e.$tooltip.html(o).css("display","block")}t.mapElem===a&&t.textElem===a||e.paper.safari&&e.paper.safari()}},elemHover:function(t,e){var o=this;if(t!==a&&t.options.tooltip!==a){var n=e.pageX,i=e.pageY,s=10,r=20;"object"==typeof t.options.tooltip.offset&&(void 0!==t.options.tooltip.offset.left&&(s=t.options.tooltip.offset.left),void 0!==t.options.tooltip.offset.top&&(r=t.options.tooltip.offset.top));var p={left:Math.min(o.$map.width()-o.$tooltip.outerWidth()-5,n-o.$map.offset().left+s),top:Math.min(o.$map.height()-o.$tooltip.outerHeight()-5,i-o.$map.offset().top+r)};"object"==typeof t.options.tooltip.overflow&&(!0===t.options.tooltip.overflow.right&&(p.left=n-o.$map.offset().left+10),!0===t.options.tooltip.overflow.bottom&&(p.top=i-o.$map.offset().top+20)),o.$tooltip.css(p)}},elemOut:function(t){var e=this;t!==a&&(t.mapElem!==a&&e.animate(t.mapElem,t.mapElem.originalAttrs,t.mapElem.attrsHover.animDuration),t.textElem!==a&&e.animate(t.textElem,t.textElem.originalAttrs,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==a&&e.$tooltip.css({display:"none",top:-1e3,left:-1e3}),t.mapElem===a&&t.textElem===a||e.paper.safari&&e.paper.safari())},elemClick:function(t){t!==a&&(this.panning||t.options.href===a||window.open(t.options.href,t.options.target))},getElemOptions:function(e,o,n){var i=t.extend(!0,{},e,o);if(i.value!==a)if(t.isArray(n))for(var s=0;s<n.length;++s)i=t.extend(!0,{},i,this.getLegendSlice(i.value[s],n[s]));else i=t.extend(!0,{},i,this.getLegendSlice(i.value,n));return i},getTextPosition:function(t,e,o){var a=0,n=0,i="";switch("number"==typeof o&&(o="bottom"===e||"top"===e?{x:0,y:o}:"right"===e||"left"===e?{x:o,y:0}:{x:0,y:0}),e){case"bottom":a=(t.x+t.x2)/2+o.x,n=t.y2+o.y,i="middle";break;case"top":a=(t.x+t.x2)/2+o.x,n=t.y-o.y,i="middle";break;case"left":a=t.x-o.x,n=(t.y+t.y2)/2+o.y,i="end";break;case"right":a=t.x2+o.x,n=(t.y+t.y2)/2+o.y,i="start";break;default:a=(t.x+t.x2)/2+o.x,n=(t.y+t.y2)/2+o.y,i="middle"}return{x:a,y:n,textAnchor:i}},getLegendSlice:function(t,e){for(var o=0;o<e.slices.length;++o)if(e.slices[o].sliceValue!==a&&t===e.slices[o].sliceValue||e.slices[o].sliceValue===a&&(e.slices[o].min===a||t>=e.slices[o].min)&&(e.slices[o].max===a||t<=e.slices[o].max))return e.slices[o];return{}},animateViewBox:function(t,o,a,n,i,s){var r=this,p=r.currentViewBox.x,l=t-p,m=r.currentViewBox.y,c=o-m,d=r.currentViewBox.w,h=a-d,f=r.currentViewBox.h,g=n-f;r.zoomAnimCVBTarget||(r.zoomAnimCVBTarget={x:t,y:o,w:a,h:n});var u=d>a?"in":"out",x=e.easing_formulas[s||"linear"],v=i-2*i/100,w=r.zoomAnimStartTime;r.zoomAnimStartTime=(new Date).getTime();var y=function(){r.cancelAnimationFrame(r.zoomAnimID);var e=(new Date).getTime()-r.zoomAnimStartTime;if(e<v){var s,E,z,C;if(w&&r.zoomAnimCVBTarget&&r.zoomAnimCVBTarget.w!==a){var O=(new Date).getTime()-w,B=x(O/i);s=p+(r.zoomAnimCVBTarget.x-p)*B,E=m+(r.zoomAnimCVBTarget.y-m)*B,z=d+(r.zoomAnimCVBTarget.w-d)*B,C=f+(r.zoomAnimCVBTarget.h-f)*B,l=t-(p=s),c=o-(m=E),h=a-(d=z),g=n-(f=C),r.zoomAnimCVBTarget={x:t,y:o,w:a,h:n}}else{var b=x(e/i);s=p+l*b,E=m+c*b,z=d+h*b,C=f+g*b}"in"===u&&(z>r.currentViewBox.w||z<a)||"out"===u&&(z<r.currentViewBox.w||z>a)||r.setViewBox(s,E,z,C),r.zoomAnimID=r.requestAnimationFrame(y)}else r.zoomAnimStartTime=null,r.zoomAnimCVBTarget=null,r.currentViewBox.w!==a&&r.setViewBox(t,o,a,n),r.$map.trigger("afterZoom",{x1:t,y1:o,x2:t+a,y2:o+n})};y()},requestAnimationFrame:function(t){return this._requestAnimationFrameFn.call(window,t)},cancelAnimationFrame:function(t){this._cancelAnimationFrameFn.call(window,t)},_requestAnimationFrameFn:(n=(new Date).getTime(),i=function(t){var e=(new Date).getTime();if(!(e-n>16))return setTimeout((function(){i(t)}),0);n=e,t(e)},window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||i),_cancelAnimationFrameFn:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||clearTimeout,setViewBox:function(t,e,o,a){var n=this;n.currentViewBox.x=t,n.currentViewBox.y=e,n.currentViewBox.w=o,n.currentViewBox.h=a,n.paper.setViewBox(t,e,o,a,!1)},_nonAnimatedAttrs:["arrow-end","arrow-start","gradient","class","cursor","text-anchor","font","font-family","font-style","font-weight","letter-spacing","src","href","target","title","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit"],animate:function(t,e,o,n){if(t)if(o>0){for(var i={},s=0;s<this._nonAnimatedAttrs.length;s++){var r=this._nonAnimatedAttrs[s];e[r]!==a&&(i[r]=e[r])}t.attr(i),t.animate(e,o,"linear",(function(){n&&n()}))}else t.attr(e),n&&n()},isRaphaelBBoxBugPresent:function(){var t=this.paper.text(-50,-50,"TEST"),e=t.getBBox();return t.remove(),0===e.width&&0===e.height},defaultOptions:{map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"area"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"plot"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"link"},zoom:{enabled:!1,minLevel:0,maxLevel:10,step:.25,mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear",buttons:{reset:{cssClass:"zoomButton zoomReset",content:"&#8226;",title:"Reset zoom"},in:{cssClass:"zoomButton zoomIn",content:"+",title:"Zoom in"},out:{cssClass:"zoomButton zoomOut",content:"&#8722;",title:"Zoom out"}}}},legend:{redrawOnResize:!0,area:[],plot:[]},areas:{},plots:{},links:{}},legendDefaultOptions:{area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"}}},r.version="2.2.0",t.mapael===a&&(t.mapael=r),t.fn.mapael=function(e){return this.each((function(){t.data(this,s)&&t.data(this,s).destroy(),t.data(this,s,new r(this,e))}))},r}));